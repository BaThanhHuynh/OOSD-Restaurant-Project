<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý Bàn ăn</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* CSS Giao diện (Mô phỏng giống hình bạn gửi) */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        body { display: flex; background-color: #f5f7fa; height: 100vh; }

        /* Sidebar bên trái */
        .sidebar { width: 250px; background-color: #ffffff; padding: 20px; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; }
        .logo { font-size: 20px; font-weight: bold; margin-bottom: 40px; color: #333; display: flex; align-items: center; gap: 10px; }
        .logo i { color: #00b894; }
        .menu-item { padding: 12px 15px; margin-bottom: 5px; border-radius: 8px; cursor: pointer; color: #666; display: flex; align-items: center; gap: 10px; text-decoration: none; transition: 0.3s; }
        .menu-item:hover { background-color: #f0f0f0; }
        .menu-item.active { background-color: #009432; color: white; }
        
        /* Nội dung chính bên phải */
        .main-content { flex: 1; padding: 30px; overflow-y: auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .search-bar { width: 400px; padding: 10px 15px; border-radius: 8px; border: 1px solid #ddd; outline: none; }
        .btn-add { background-color: #009432; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        
        /* Grid danh sách bàn */
        .table-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        
        /* Thẻ Bàn (Card) */
        .table-card { background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 2px solid transparent; transition: 0.3s; }
        .table-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .table-icon { font-size: 40px; margin-bottom: 15px; color: #b2bec3; }
        
        /* Màu sắc theo trạng thái */
        .status-AVAILABLE { border-color: #00b894; }
        .status-AVAILABLE .table-icon { color: #00b894; }
        .status-AVAILABLE .status-text { color: #00b894; font-weight: bold; font-size: 12px; }
        
        .status-OCCUPIED { border-color: #f1c40f; }
        .status-OCCUPIED .table-icon { color: #f1c40f; }
        .status-OCCUPIED .status-text { color: #f39c12; font-weight: bold; font-size: 12px; }

        /* Nút hành động trên thẻ */
        .btn-action { margin-top: 15px; padding: 8px 16px; border-radius: 20px; border: none; cursor: pointer; font-weight: 600; width: 100%; }
        .btn-open { background-color: #ecfdf5; color: #009432; }
        .btn-open:hover { background-color: #d1fae5; }
        
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="logo"><i class="fas fa-utensils"></i> 4TL RES POS</div>
        <a href="#" class="menu-item"><i class="fas fa-th"></i> Menu</a>
        <a href="#" class="menu-item active"><i class="fas fa-couch"></i> Quản lý bàn</a>
        <a href="#" class="menu-item"><i class="fas fa-clock"></i> Trạng thái món</a>
    </div>

    <div class="main-content">
        <div class="header">
            <h2>Sơ đồ bàn & Trạng thái</h2>
            <input type="text" class="search-bar" placeholder="Tìm kiếm bàn...">
            <button class="btn-add"><i class="fas fa-plus"></i> Thêm bàn</button>
        </div>

        <div class="table-grid" id="table-container">
            <p>Đang tải dữ liệu từ Backend...</p>
        </div>
    </div>

    <script>
        // Đường dẫn API (Cổng 8080 của Spring Boot)
        const API_URL = "http://localhost:8080/api/tables";

        // 1. Hàm load danh sách bàn khi trang web vừa mở
        async function loadTables() {
            try {
                const response = await fetch(API_URL);
                const tables = await response.json();
                
                console.log("Dữ liệu nhận được:", tables); // Xem trong Console (F12)
                renderTables(tables);
            } catch (error) {
                console.error("Lỗi kết nối:", error);
                document.getElementById('table-container').innerHTML = 
                    '<p style="color:red">Không thể kết nối tới Server Backend (Port 8080)!</p>';
            }
        }

        // 2. Hàm vẽ giao diện HTML từ dữ liệu JSON
        function renderTables(tables) {
            const container = document.getElementById('table-container');
            container.innerHTML = ''; // Xóa chữ "Đang tải..."

            tables.forEach(table => {
                // Xác định trạng thái để tô màu và đổi chữ nút bấm
                let statusLabel = '';
                let actionBtn = '';

                if (table.status === 'AVAILABLE') {
                    statusLabel = 'TRỐNG';
                    actionBtn = `<button class="btn-action btn-open" onclick="openTable(${table.id})">Mở bàn</button>`;
                } else if (table.status === 'OCCUPIED') {
                    statusLabel = 'CÓ KHÁCH';
                    actionBtn = `<button class="btn-action" style="background:#fff3cd; color:#856404">Gọi món</button>`;
                } else {
                    statusLabel = table.status;
                }

                // Tạo thẻ HTML
                const html = `
                    <div class="table-card status-${table.status}">
                        <div class="table-icon"><i class="fas fa-utensils"></i></div>
                        <h3>Bàn ${table.tableNumber}</h3>
                        <p style="color:#777; font-size:13px; margin: 5px 0;">${table.capacity} Ghế • <span class="status-text">${statusLabel}</span></p>
                        ${actionBtn}
                    </div>
                `;
                container.innerHTML += html;
            });
        }

        // 3. Hàm gọi API Mở bàn (Check-in)
        async function openTable(id) {
            if(!confirm("Bạn có chắc muốn mở bàn này không?")) return;

            try {
                // Gọi API POST: /api/tables/{id}/open
                const response = await fetch(`${API_URL}/${id}/open`, { method: 'POST' });
                
                if (response.ok) {
                    alert("Mở bàn thành công!");
                    loadTables(); // Load lại danh sách để cập nhật trạng thái mới
                } else {
                    const msg = await response.text();
                    alert("Lỗi: " + msg);
                }
            } catch (error) {
                console.error(error);
                alert("Lỗi hệ thống!");
            }
        }

        // Chạy hàm loadTables ngay khi trang web tải xong
        document.addEventListener('DOMContentLoaded', loadTables);
    </script>
</body>
</html>